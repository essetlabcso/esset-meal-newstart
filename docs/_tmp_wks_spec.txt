 `n`n # ESSET MEAL Platform — Front-End Specification `n`n ## Scope: (1) User Onboarding, (2) Workspace Creation + Management (WKS) `n`n **Status:** Final / Implementation-ready `n`n **Applies to:** Multi-tenant (workspace/org scoped), “Invisible Wall” security UX `n`n `n`n --- `n`n `n`n ## 0) Non-Negotiable UX + Security Principles `n`n `n`n ### 0.1 Workflow clarity `n`n - Users must never land in a “blank” state after login. `n`n - Every state must present a clear next step (Create workspace / Join via invite / Select workspace / Go to dashboard). `n`n `n`n ### 0.2 Invisible Wall (existence must not leak) `n`n - Unauthorized access must not confirm whether a workspace exists. `n`n - Any cross-org guessing (URL tampering, ID guessing) must resolve as: `n`n - **404 Not Found** OR **empty state** (preferred: 404 for org routes) `n`n - never a “403 Forbidden” that confirms existence. `n`n `n`n ### 0.3 Response silence for unauthorized data `n`n - Lists return **0 rows** if out-of-scope. `n`n - Detail pages show **Not Found** if not accessible. `n`n `n`n ### 0.4 Org-scoped routing is mandatory `n`n - Post-auth always resolves to an **org-scoped route**: `n`n - `/app/:orgId/dashboard` (not a global `/app` landing without org context) `n`n `n`n --- `n`n `n`n ## 1) User Roles for Workspace Scope `n`n `n`n > These roles apply to workspace-level features in this spec. `n`n `n`n - **owner**: full workspace control, can manage members and settings. `n`n - **editor**: can work in projects; cannot manage members (unless explicitly granted later). `n`n - **contributor**: can contribute within projects/data capture; cannot manage members. `n`n - **viewer**: read-only access; cannot manage members. `n`n `n`n ### 1.1 Workspace permissions matrix `n`n `n`n | UI Area / Action | owner | editor | contributor | viewer | `n`n |---|---:|---:|---:|---:| `n`n | See workspace switcher | ✅ | ✅ | ✅ | ✅ | `n`n | Access `/app/:orgId/dashboard` | ✅ | ✅ | ✅ | ✅ | `n`n | View Members page | ✅ | (optional view-only)* | ❌ | ❌ | `n`n | Invite member | ✅ | ❌ | ❌ | ❌ | `n`n | Change member role | ✅ | ❌ | ❌ | ❌ | `n`n | Deactivate/remove member | ✅ | ❌ | ❌ | ❌ | `n`n | Workspace settings (Branding) | ✅ | ❌ | ❌ | ❌ | `n`n `n`n \* Default: **only owner can view** member list (stronger privacy). If you choose “view-only for editor”, implement with explicit gating. `n`n `n`n --- `n`n `n`n ## 2) Routing + Navigation Requirements `n`n `n`n ### 2.1 Required routes `n`n `n`n **Public** `n`n - `/auth/sign-in` `n`n - `/auth/sign-up` (optional, depends on policy) `n`n - `/invites/accept?token=...` `n`n `n`n **Onboarding** `n`n - `/initialize` (mandatory post-auth gate) `n`n - `/workspaces/new` (optional; can be modal launched from `/initialize`) `n`n `n`n **Org-scoped app** `n`n - `/app/:orgId/dashboard` `n`n - `/app/:orgId/projects` (project list entry point; minimal shell only) `n`n - `/app/:orgId/settings/members` `n`n - `/app/:orgId/settings/branding` `n`n `n`n ### 2.2 Post-auth redirect rule `n`n After successful authentication, user is always redirected to: `n`n - `GET /initialize` `n`n `n`n No other direct post-auth destination is allowed. `n`n `n`n --- `n`n `n`n ## 3) Initialization Gate (Deterministic State Machine) `n`n `n`n ### 3.1 Inputs `n`n - Authenticated user session `n`n - Workspace memberships list (active only) `n`n - Optional persisted “last active org” (cookie/local storage) `n`n - Optional invite token continuation (if coming from `/invites/accept`) `n`n `n`n ### 3.2 State machine `n`n `n`n **State A — Resolving** `n`n - UI: spinner + message “Checking your workspace access…” `n`n `n`n **State B — 0 active workspaces** `n`n - UI: “Create workspace” + “Join via invite” `n`n - If policy disables creation: hide or disable Create button (see §4.3) `n`n `n`n **State C — 1 active workspace** `n`n - Auto-select that workspace `n`n - Redirect to `/app/:orgId/dashboard` `n`n `n`n **State D — >1 active workspaces** `n`n - Show workspace picker (must not auto-pick unless a valid persisted org exists) `n`n - If persisted org is valid: auto-select and redirect `n`n - If persisted org invalid: clear it and show picker `n`n `n`n **State E — Persisted org revoked** `n`n - Trigger: user requests any `/app/:orgId/*` but membership invalid `n`n - Action: clear active org + redirect to `/initialize` `n`n - UI toast (on `/initialize`): “Your workspace access has changed.” `n`n `n`n --- `n`n `n`n ## 4) Screen Specs — Onboarding `n`n `n`n ## 4.1 Sign-in (`/auth/sign-in`) `n`n **Primary** `n`n - Email/password or provider login (implementation-defined) `n`n `n`n **Secondary** `n`n - “Create account” (only if sign-up enabled) `n`n `n`n **Error handling** `n`n - Generic failure only: “We couldn’t sign you in. Try again.” `n`n - Never disclose whether an email exists. `n`n `n`n --- `n`n `n`n ## 4.2 Initialize (`/initialize`) `n`n **Purpose** `n`n Resolve membership, enable workspace creation or invite join, and route into org-scoped app. `n`n `n`n ### Layout `n`n - Header: “Welcome” `n`n - Subtitle: “Choose where you want to work.” `n`n `n`n ### Variant: Multi-workspace picker (State D) `n`n **Component: WorkspacePicker** `n`n - List items show: `n`n - Workspace name `n`n - Role pill (owner/editor/contributor/viewer) `n`n - Action: Select → redirect `/app/:orgId/dashboard` `n`n - Optional: “Create new workspace” if allowed `n`n - Optional: “Join via invite” always available `n`n `n`n ### Variant: Zero-workspace (State B) `n`n **Card 1: Create workspace** `n`n - Button: “Create workspace” `n`n - Description: “Set up a workspace for your organization/team.” `n`n `n`n **Card 2: Join via invite** `n`n - Input: “Invite link or code” `n`n - Button: “Join workspace” `n`n `n`n **Join error (invalid/expired/not accessible)** `n`n - Message: “This invite link isn’t valid. Ask your admin for a new one.” `n`n - Never: “Workspace not found” or “You are not allowed.” `n`n `n`n --- `n`n `n`n ## 4.3 Policy: “Create Workspace (if allowed)” `n`n The UI must support both modes: `n`n `n`n ### Mode 1 — Open creation `n`n - Create workspace button visible and enabled. `n`n `n`n ### Mode 2 — Admin-managed / invite-only pilot (“Velvet Rope”) `n`n Choose one: `n`n - **Option A (recommended):** Hide “Create workspace” entirely. `n`n - **Option B:** Show disabled with copy: `n`n - “Workspace creation is managed by your admin. Use an invite link.” `n`n `n`n This mode must be configured via a server-provided policy flag: `n`n - `canCreateWorkspace: boolean` `n`n `n`n --- `n`n `n`n ## 5) Workspace Creation `n`n `n`n ## 5.1 Create workspace UI (`/workspaces/new` or modal) `n`n **Fields** `n`n 1) Workspace name (required) `n`n - Placeholder: “Organization / network name” `n`n `n`n 2) Workspace URL slug (required OR auto-generated) `n`n - If user-editable: `n`n - Placeholder: “my-ngo” `n`n - Rules visible (see below) `n`n - If auto-generated: `n`n - Show read-only slug preview `n`n - Provide “Edit” option (recommended) `n`n `n`n **Slug rules (display in helper text)** `n`n - Lowercase letters, numbers, hyphens `n`n - 3–40 chars `n`n - Must be unique `n`n `n`n **Optional** `n`n - Checkbox: “Create a demo project” (non-blocking) `n`n `n`n **Primary CTA** `n`n - “Create workspace” `n`n `n`n ### 5.2 Atomic creation requirement (transactional UX) `n`n Workspace creation is only considered successful when BOTH exist: `n`n - workspace created `n`n - membership created for creator with role **owner** `n`n `n`n **Failure UX (must be defined)** `n`n - If slug conflict: inline error “That workspace URL is already taken.” `n`n - If creation fails: banner “We couldn’t finish setting up your workspace. Please try again.” `n`n - If partial completion is detected (should be prevented server-side): show same banner + provide “Retry” button. `n`n `n`n ### 5.3 Success UX `n`n - Toast: “Workspace created” `n`n - Redirect: `/app/:orgId/dashboard` `n`n - Visible role badge on dashboard/header: “Owner” `n`n `n`n --- `n`n `n`n ## 6) Org-Scoped App Shell Requirements (Minimal) `n`n `n`n Once inside `/app/:orgId/*`, the UI must always show: `n`n `n`n ### 6.1 Top context bar (Level 0) `n`n - **Workspace selector** (shows current workspace name) `n`n - **Project selector** (can be “No project selected” until project is chosen) `n`n - **User menu** (sign out) `n`n `n`n ### 6.2 Workspace switcher behavior `n`n - Shows only workspaces where the user has **active membership** `n`n - Displays role pill for each `n`n - Selecting a workspace changes context and routes to: `n`n - `/app/:orgId/dashboard` `n`n `n`n ### 6.3 Revocation handling (org guard) `n`n If user loads `/app/:orgId/*` without membership: `n`n - Render **Not Found** (preferred) or redirect to `/initialize` `n`n - Must not display “Forbidden” `n`n `n`n --- `n`n `n`n ## 7) Workspace Dashboard (`/app/:orgId/dashboard`) — Minimal “Onboarding Complete” Surface `n`n `n`n **Required content** `n`n - Title: workspace name `n`n - Role badge (owner/editor/contributor/viewer) `n`n - Primary CTA: “Go to projects” → `/app/:orgId/projects` `n`n - Secondary CTA (owner only): “Invite teammates” → `/app/:orgId/settings/members` `n`n `n`n **Empty states** `n`n - If no projects exist: `n`n - “No projects yet. Create your first project to start mapping strategy and evidence.” `n`n - Button: “Create project” (can route to project creation flow if available; otherwise placeholder) `n`n `n`n --- `n`n `n`n ## 8) Workspace Management — Members `n`n `n`n ## 8.1 Members page (`/app/:orgId/settings/members`) `n`n **Access** `n`n - owner: allowed `n`n - others: Not Found (or redirect to dashboard) per Invisible Wall rule `n`n `n`n ### Layout `n`n - Page title: “Members” `n`n - Workspace name (read-only) `n`n - Button (owner only): “Invite member” `n`n `n`n ### Members table (required columns) `n`n - Name (if available) or Email `n`n - Role (dropdown for owner; text for non-owner if view-only enabled) `n`n - Status (Active / Inactive) `n`n - Actions (owner only): `n`n - “Change role” `n`n - “Deactivate” `n`n - “Remove” `n`n `n`n ### Role change UX `n`n - Dropdown: owner/editor/contributor/viewer `n`n - Confirm modal: `n`n - “Change role for <email> to <role>?” `n`n - Confirm / Cancel `n`n `n`n ### Deactivate vs Remove (required behaviors) `n`n - **Deactivate:** membership becomes inactive; user loses access on next request. `n`n - **Remove:** membership record removed or soft-removed per backend design; user loses access on next request. `n`n - After action, show toast: `n`n - “Member updated” / “Member removed” `n`n `n`n ### Immediate revocation UX `n`n If a removed user is currently active in the workspace, next request must kick them to `/initialize`. `n`n - Show toast on `/initialize`: “Your workspace access has changed.” `n`n `n`n --- `n`n `n`n ## 9) Workspace Management — Invites `n`n `n`n ## 9.1 Invite modal/panel (owner only) `n`n **Fields** `n`n - Email `n`n - Role (owner/editor/contributor/viewer) `n`n - Default: contributor (recommended) `n`n - Expiry: `n`n - presets: 3 days / 7 days / 14 days `n`n - or date picker (optional) `n`n `n`n **Primary CTA** `n`n - “Send invite” `n`n `n`n **Success state** `n`n - Toast: “Invite sent” `n`n - Show pending invite row (optional but recommended): `n`n - Email, role, status “Pending”, expiry `n`n - Actions: “Copy link”, “Revoke” `n`n `n`n ## 9.2 Invite acceptance (`/invites/accept?token=...`) `n`n **Flow** `n`n 1) If not authenticated → redirect to `/auth/sign-in` then return here `n`n 2) Validate token `n`n 3) If valid: `n`n - Show: “Accept invite” `n`n - Display workspace name ONLY after validation succeeds `n`n - Button: “Accept and continue” `n`n 4) On accept success: `n`n - Redirect to `/app/:orgId/dashboard` `n`n `n`n **Invalid/expired/not accessible** `n`n - Show only: “This invite link isn’t valid. Ask your admin for a new one.” `n`n - Provide: “Back to initialize” button `n`n `n`n --- `n`n `n`n ## 10) Workspace Management — Branding `n`n `n`n ## 10.1 Branding page (`/app/:orgId/settings/branding`) `n`n **Access** `n`n - owner only `n`n `n`n **Fields** `n`n - Workspace display name (editable) `n`n - Logo upload (image) `n`n - Optional: Accent color (or “Default”) `n`n - Optional: Short tagline (if used elsewhere) `n`n `n`n **CTA** `n`n - “Save changes” `n`n - Toast on success: “Workspace updated” `n`n `n`n **Errors** `n`n - Generic: “We couldn’t save your changes. Try again.” `n`n `n`n --- `n`n `n`n ## 11) Standard UI Components (Implementation Contracts) `n`n `n`n ### 11.1 `OrgGuard` `n`n - Runs on all `/app/:orgId/*` routes `n`n - Verifies active membership `n`n - If invalid: Not Found or redirect `/initialize` (pick one and use consistently) `n`n `n`n ### 11.2 `WorkspaceSwitcher` `n`n - Displays active workspace + role `n`n - Lists active memberships only `n`n - Switch action routes to `/app/:orgId/dashboard` `n`n `n`n ### 11.3 `WorkspacePicker` `n`n - Used in `/initialize` when memberships > 1 `n`n - Selection routes to `/app/:orgId/dashboard` `n`n `n`n ### 11.4 `InviteJoinForm` `n`n - Used in `/initialize` `n`n - Accepts invite token/link `n`n - Uses generic invalid message on failure `n`n `n`n --- `n`n `n`n ## 12) Copy Rules (Microcopy Standards) `n`n `n`n - Use plain language; avoid jargon. `n`n - Never display “Forbidden”, “You don’t have permission”, or “Workspace exists but…” `n`n - Prefer: `n`n - “Not found” `n`n - “This invite link isn’t valid” `n`n - “Your workspace access has changed” `n`n `n`n --- `n`n `n`n ## 13) Acceptance Criteria (UI/UX) `n`n `n`n ### A) Initialization Gate `n`n - After login, user always lands on `/initialize`. `n`n - Membership resolution shows spinner then correct state: `n`n - 0 workspaces → create/join `n`n - 1 workspace → auto-redirect `/app/:orgId/dashboard` `n`n - >1 workspace → picker shown (unless persisted org valid) `n`n `n`n ### B) Create Workspace `n`n - Workspace creation collects name + slug (or generates slug) `n`n - Slug uniqueness error shown inline `n`n - On success: `n`n - creator becomes `owner` `n`n - redirect `/app/:orgId/dashboard` `n`n - workspace visible in switcher `n`n `n`n ### C) Invite-only mode `n`n - When `canCreateWorkspace=false`, create option hidden or disabled with correct copy. `n`n - Invite join works from `/initialize` for users with 0 workspaces. `n`n `n`n ### D) Members management `n`n - Owner can invite, change roles, deactivate/remove. `n`n - Non-owner cannot access Members page (Not Found or redirect). `n`n - Removing a member immediately revokes access on next request and returns user to `/initialize`. `n`n `n`n ### E) Invisible Wall `n`n - Visiting `/app/:otherOrgId/*` without membership yields Not Found (or equivalent), never permission leak. `n`n - APIs/lists never disclose other org entities. `n`n `n`n --- `n`n `n`n ## 14) Implementation Notes (Front-end only, to guide engineering) `n`n - All privileged actions (invite/create/update) must be server-mediated. `n`n - Cache carefully: org membership must be treated as highly dynamic (revocation must apply immediately on next request). `n`n - Persist active org in a cookie/local storage, but always validate on server load. `n`n `n`n --- `n`n `n`n`n 
