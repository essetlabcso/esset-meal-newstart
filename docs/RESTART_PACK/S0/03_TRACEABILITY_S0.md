# S0 Traceability Matrix (A2 Seed)

Canonical source: `docs/enhanced_master_spec_v0_1_18012026.md` (read-only)

| Feature/Rule ID | Spec section | Entities | API/Server module | UI surface | Tests | Gate proof | Status | Notes |
|---|---|---|---|---|---|---|---|---|
| TOC-UX-01 | 5.1 Tri-state UX modes | `toc_versions`, `toc_nodes`, `toc_edges` | `src/app/app/projects/[projectId]/toc/actions.ts` | `src/app/app/projects/[projectId]/toc/page.tsx`, `src/app/app/projects/[projectId]/toc/TocGraphClient.tsx` | `tests/gate23_toc_publish.e2e.spec.ts` | `docs/PHASE_S0_PROOF_PACK.md` | Partial / Proof Blocked | UI exists; full tri-mode parity not runtime-proven in current environment. |
| TOC-UX-02 | 5.1.1 Wizard mode friction bump | `toc_nodes`, `toc_edges` | `src/app/app/projects/[projectId]/toc/actions.ts` | `src/app/app/projects/[projectId]/toc/page.tsx` | N/A | `docs/PHASE_S0_PROOF_PACK.md` | Pending | Explicit Add New vs Link Existing UX contract is only partially enforced. |
| TOC-MP-01 | 5.2 Multi-parenting: Primary Parent Rule | `toc_nodes` (`primary_parent_id`) | `supabase/migrations/20260218020000_s0_canonical_slice.sql` | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/s0_toc_projection_contract.sql` | `supabase/tests/s0_toc_projection_contract.sql` | Implemented / Proof Blocked | SQL proof exists but Docker runtime is blocked. |
| TOC-MP-02 | 5.2 Multi-parenting: Secondary links | `toc_edges` (`edge_kind=secondary_link`), `toc_projections` | `supabase/migrations/20260218020000_s0_canonical_slice.sql` | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/s0_toc_projection_contract.sql` | `supabase/tests/s0_toc_projection_contract.sql` | Implemented / Proof Blocked | Ghost-row behavior is implemented and scripted for proof. |
| TOC-MP-03 | 5.2 Multi-parenting: Rehome is explicit | `toc_nodes` (`primary_parent_id`), audit surface | N/A | N/A | N/A | `docs/PHASE_S0_PROOF_PACK.md` | Pending | Explicit rehome confirmation/audit action is not fully wired as a dedicated flow yet. |
| TOC-PROJ-01 | 5.4 Projection algorithm: primary path key generation | `toc_nodes.primary_path_key` | `supabase/migrations/20260218020000_s0_canonical_slice.sql` (`rebuild_toc_projections`) | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/s0_toc_projection_contract.sql` | `supabase/tests/s0_toc_projection_contract.sql` | Implemented / Proof Blocked | SQL proof cannot run without Docker. |
| TOC-PROJ-02 | 5.4 Projection algorithm: ghost row generation | `toc_projections`, `toc_edges.edge_kind` | `supabase/migrations/20260218020000_s0_canonical_slice.sql` | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/s0_toc_projection_contract.sql` | `supabase/tests/s0_toc_projection_contract.sql` | Implemented / Proof Blocked | Uses secondary links to derive ghost paths. |
| TOC-PROJ-03 | 5.4 Projection algorithm: content not duplicated | `toc_projections`, `toc_nodes` | `supabase/migrations/20260218020000_s0_canonical_slice.sql` | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/s0_toc_projection_contract.sql` | `supabase/tests/s0_toc_projection_contract.sql` | Implemented / Proof Blocked | Single GUID projection model is present. |
| TOC-PROJ-04 | 5.4 Projection algorithm: deterministic ordering | `toc_projections.path_key` | `supabase/migrations/20260218020000_s0_canonical_slice.sql` | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/s0_toc_projection_contract.sql` | `supabase/tests/s0_toc_projection_contract.sql` | Implemented / Proof Blocked | Ordered projection query exists; runtime proof blocked. |
| TOC-PUB-01 | 5.5 Publish lifecycle: atomic + snapshot binding | `toc_versions`, `analysis_snapshots` | `supabase/migrations/20260218020000_s0_canonical_slice.sql` (`publish_toc_version`) | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/toc_gate_a_publish.sql`, `supabase/tests/s0_export_manifest_hash.sql` | `supabase/tests/toc_gate_a_publish.sql` | Implemented / Proof Blocked | Freeze snapshot copy and binding implemented in RPC. |
| TOC-PUB-02 | 5.5 Publish lifecycle: immutability after publish | `toc_versions`, `toc_nodes`, `toc_edges` | `supabase/migrations/20260217093000_gate23_toc_gate_a_publish_cow.sql`, `supabase/migrations/20260218020000_s0_canonical_slice.sql` | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/toc_gate_a_publish.sql`, `tests/gate23_toc_publish.e2e.spec.ts` | `supabase/tests/toc_gate_a_publish.sql` | Implemented / Proof Blocked | Published edit rejection + new draft COW flow scripted. |
| GA-01 | 6.2 Gate A MUST rules | `toc_nodes` | `supabase/migrations/20260218020000_s0_canonical_slice.sql` (`validate_gate_a`) | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/s0_toc_gate_a_full.sql` | `supabase/tests/s0_toc_gate_a_full.sql` | Implemented / Proof Blocked | Deterministic code: `GA_ERR_GOAL_COUNT`. |
| GA-02 | 6.2 Gate A MUST rules | `toc_nodes` (`primary_parent_id`) | `supabase/migrations/20260218020000_s0_canonical_slice.sql` | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/s0_toc_gate_a_full.sql`, `supabase/tests/toc_gate_a_publish.sql` | `supabase/tests/s0_toc_gate_a_full.sql` | Implemented / Proof Blocked | Deterministic code: `GA_ERR_ORPHANS`. |
| GA-03 | 6.2 Gate A MUST rules | `toc_nodes` type hierarchy | `supabase/migrations/20260218020000_s0_canonical_slice.sql` | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/s0_toc_gate_a_full.sql` | `supabase/tests/s0_toc_gate_a_full.sql` | Implemented / Proof Blocked | Deterministic code: `GA_ERR_TYPE_CHAIN`. |
| GA-04 | 6.2 Gate A MUST rules | `toc_edges` causal graph | `supabase/migrations/20260218020000_s0_canonical_slice.sql` | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/s0_toc_gate_a_full.sql` | `supabase/tests/s0_toc_gate_a_full.sql` | Implemented / Proof Blocked | Deterministic code: `GA_ERR_CAUSAL_CYCLE`; feedback excluded. |
| GA-05 | 6.2 Gate A MUST rules | `toc_edges` uniqueness | `supabase/migrations/20260218020000_s0_canonical_slice.sql` (unique index) | N/A | `supabase/tests/s0_toc_gate_a_full.sql` | `supabase/tests/s0_toc_gate_a_full.sql` | Implemented / Proof Blocked | Deterministic code: `GA_ERR_DUP_EDGE`. |
| GA-06 | 6.2 Gate A MUST rules | `toc_edges.mechanism` | `supabase/migrations/20260218020000_s0_canonical_slice.sql` | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/s0_toc_gate_a_full.sql` | `supabase/tests/s0_toc_gate_a_full.sql` | Implemented / Proof Blocked | Deterministic code: `GA_ERR_EDGE_MECH`. |
| GA-07 | 6.2 Gate A MUST rules | `toc_edges.confidence`, `toc_edges.risk_flag`, `sentinel_indicator_id` | `supabase/migrations/20260218020000_s0_canonical_slice.sql` | N/A | `supabase/tests/s0_toc_gate_a_full.sql` | `supabase/tests/s0_toc_gate_a_full.sql` | Implemented / Proof Blocked | Deterministic code: `GA_ERR_SENTINEL`. |
| GA-08 | 6.2 Gate A MUST rules | RLS-required tables + policies | `supabase/migrations/20260218020000_s0_canonical_slice.sql` (`ga_rls_baseline_ok`) | N/A | `supabase/tests/s0_toc_gate_a_full.sql` | `supabase/tests/s0_toc_gate_a_full.sql` | Implemented / Proof Blocked | Deterministic code: `GA_ERR_RLS_BASELINE`. |
| SEC-03 | 8.1 Tenant isolation: Invisible Wall | RLS on tenant-scoped tables | `supabase/migrations/20260215184100_gate5_1_hardening.sql`, `supabase/migrations/20260215184200_gate5_1a_fix_rls_qual.sql` | `src/app/app/projects/[projectId]/page.tsx` | `supabase/tests/toc_rls_zero_rows.sql`, `supabase/tests/s0_sec_stop_ship.sql` | `supabase/tests/s0_sec_stop_ship.sql` | Implemented / Proof Blocked | DB proof blocked by missing Docker engine. |
| SEC-04 | 8.1 Response silence | Query/result behavior under unauthorized context | `supabase/migrations/20260215184100_gate5_1_hardening.sql` | `src/app/app/projects/[projectId]/page.tsx` | `tests/gate22_wks_prj_context.e2e.spec.ts` | `tests/gate22_wks_prj_context.e2e.spec.ts` | Implemented / Proof Blocked | E2E is skipped when auth env vars are missing. |
| SEC-TEST-01 | 8.2 Stop-ship negative tests | Cross-tenant project/toc reads | `supabase/tests/toc_rls_zero_rows.sql`, `supabase/tests/s0_sec_stop_ship.sql` | `src/app/app/projects/[projectId]/page.tsx` | `supabase/tests/toc_rls_zero_rows.sql`, `supabase/tests/s0_sec_stop_ship.sql`, `tests/gate22_wks_prj_context.e2e.spec.ts` | `supabase/tests/s0_sec_stop_ship.sql` | Implemented / Proof Blocked | Required behavior: 0 rows/not found. |
| SEC-TEST-02 | 8.2 Stop-ship negative tests | Cross-tenant write rejection | `supabase/tests/s0_sec_stop_ship.sql` | N/A | `supabase/tests/s0_sec_stop_ship.sql` | `supabase/tests/s0_sec_stop_ship.sql` | Implemented / Proof Blocked | Write rejection test is present but not runtime-executed locally. |
| SEC-TEST-03 | 8.2 Stop-ship negative tests | Client bundle/service-role exposure scan | `scripts/s0_spec_drift_check.mjs`, `.github/workflows/s0_drift_guard.yml` | N/A | `node scripts/s0_spec_drift_check.mjs` | `node scripts/s0_spec_drift_check.mjs` | Runtime-Proven | Last run: `S0_DRIFT_PASS`. |
| RPT-01 | 4.5 Reporting manifest | `report_manifests` | `supabase/migrations/20260218020000_s0_canonical_slice.sql` (`export_matrix_csv`) | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/s0_export_manifest_hash.sql` | `supabase/tests/s0_export_manifest_hash.sql` | Implemented / Proof Blocked | Deterministic hash + manifest persistence scripted. |
| RPT-02 | 7.3 Snapshot-bound reporting | `toc_versions.linked_analysis_snapshot_id`, `report_manifests` | `supabase/migrations/20260218020000_s0_canonical_slice.sql`, `src/app/app/projects/[projectId]/toc/actions.ts` | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/s0_export_manifest_hash.sql`, `tests/s0_export_auth.e2e.spec.ts` | `supabase/tests/s0_export_manifest_hash.sql` | Implemented / Proof Blocked | Export bound to published version + linked snapshot. |
| AN-01 | 10.1 Contribution mode | Export allocation mode contract | `supabase/migrations/20260218020000_s0_canonical_slice.sql` | N/A | `supabase/tests/s0_export_manifest_hash.sql`, `node scripts/s0_spec_drift_check.mjs` | `supabase/tests/s0_export_manifest_hash.sql` | Implemented / Proof Blocked | Weighted allocation explicitly rejected. |
| AN-02 | 10.1 Contribution mode | De-dup by GUID in projection/export | `supabase/migrations/20260218020000_s0_canonical_slice.sql` | N/A | `supabase/tests/s0_export_manifest_hash.sql` | `supabase/tests/s0_export_manifest_hash.sql` | Implemented / Proof Blocked | Runtime SQL proof blocked. |
| AN-03 | 10.1 Contribution mode | Reconciliation footnotes in export | `supabase/migrations/20260218020000_s0_canonical_slice.sql` | `src/app/app/projects/[projectId]/toc/page.tsx` | `supabase/tests/s0_export_manifest_hash.sql` | `supabase/tests/s0_export_manifest_hash.sql` | Implemented / Proof Blocked | Footnote output exists in export builder path. |

## Current Runtime Snapshot
- Verdict: **NO-GO**
- Blockers:
  - Docker engine unavailable (`dockerDesktopLinuxEngine` not found).
  - Missing auth runtime env vars (`NEXT_PUBLIC_SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY`).
